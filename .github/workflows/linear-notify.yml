name: Linear API Key Suite

on:
  workflow_dispatch:
  push:
    paths:
      - scripts/**
      - justfile
      - .env

jobs:
  linear-run:
    runs-on: ubuntu-latest
    env:
      LINEAR_API_KEY: ${{ secrets.LINEAR_API_KEY }}

    steps:
      - name: â¬‡ï¸ Checkout repo
        uses: actions/checkout@v4

      - name: ğŸ›  Set up environment
        run: |
          mkdir -p .linear .archive
          echo "LINEAR_API_KEY=${LINEAR_API_KEY}" >> .env

      - name: ğŸ§ª Run Linear suite
        run: just run

      - name: ğŸ§¾ Log summary
        run: cat .linear/summary.md

      - name: ğŸ“¦ Archive response
        run: |
          STAMP=$(date -u +%Y-%m-%dT%H-%M-%SZ)
          cp .linear/api_response.json ".archive/api_response.$STAMP.json"

      - name: ğŸ§¹ Clean workspace
        run: just clean
